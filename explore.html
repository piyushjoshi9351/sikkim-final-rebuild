<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Explore — Sikkim Monasteries</title>
<link rel="stylesheet" href="assets/css/theme.css">
<script src="assets/js/app.js" defer></script>
<style>
  /* Extra explore-page styling */
  .controls {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-bottom: 20px;
    align-items: center;
  }
  .controls input, .controls select {
    padding: 10px 14px;
    border: 1px solid var(--border,#d4d4d8);
    border-radius: 12px;
    outline: none;
    font-size: 0.95rem;
    flex: 1;
    min-width: 160px;
    transition: all .3s ease;
  }
  .controls input:focus, .controls select:focus {
    border-color: var(--accent,#2563eb);
    box-shadow: 0 0 0 3px rgba(37,99,235,.15);
  }

  .cards {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(250px,1fr));
    gap: 20px;
  }
  .card {
    background: var(--glass,rgba(255,255,255,0.05));
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 8px 24px rgba(0,0,0,.08);
    cursor: pointer;
    transform: scale(1);
    transition: transform .25s, box-shadow .25s;
  }
  .card:hover {
    transform: translateY(-6px) scale(1.02);
    box-shadow: 0 12px 32px rgba(0,0,0,.15);
  }
  .card img {
    width: 100%;
    height: 170px;
    object-fit: cover;
  }
  .card h3 {
    margin: 12px;
    font-size: 1.15rem;
  }
  .card p {
    margin: 0 12px 16px;
    color: var(--muted,#64748b);
    font-size: .9rem;
  }

  /* Modal enhancements */
  .modal[aria-hidden="false"] {
    opacity: 1;
    pointer-events: auto;
    transform: scale(1);
  }
  .modal {
    position: fixed;
    inset: 0;
    background: rgba(15,23,42,.6);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    opacity: 0;
    pointer-events: none;
    transition: all .3s ease;
  }
  .modal-content {
    background: var(--card,#fff);
    border-radius: 20px;
    max-width: 920px;
    width: 90%;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    padding: 24px;
    position: relative;
    transform: scale(.95);
    transition: all .3s ease;
  }
  .modal-left img {
    width: 100%;
    height: 100%;
    max-height: 380px;
    object-fit: cover;
    border-radius: 14px;
  }
  .thumbbar {
    display: flex;
    gap: 8px;
    margin-top: 10px;
    overflow-x: auto;
  }
  .thumbbar img {
    width: 70px;
    height: 50px;
    border-radius: 6px;
    object-fit: cover;
    cursor: pointer;
    opacity: .75;
    transition: .2s;
  }
  .thumbbar img:hover { opacity: 1; transform: scale(1.05); }
  @media(max-width:760px){
    .modal-content { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<header class="header">
  <div class="container header-inner">
    <a class="brand" href="index.html">
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6d/Dharma_wheel.svg/1024px-Dharma_wheel.svg.png" alt="logo">
      <strong>Sikkim Monasteries</strong>
    </a>
    <nav class="nav">
      <a href="index.html">Home</a>
      <a href="explore.html" class="active">Explore</a>
      <a href="map.html">Map</a>
      <a href="about.html">About</a>
      <a href="view360.html">360°</a>
      <a href="guide.html">Visitor Guide</a>
    </nav>
  </div>
</header>

<main class="container section">
  <h2>Explore Monasteries</h2>

  <!-- Controls -->
  <div class="controls">
    <input id="q" class="search" placeholder="🔍 Search by name or notes">
    <select id="district"><option value="">All Districts</option></select>
    <select id="tradition"><option value="">All Traditions</option></select>
  </div>

  <!-- Monasteries list -->
  <div id="explore-list" class="cards"></div>
</main>

<footer class="footer">© 2025 Sikkim Monasteries</footer>

<!-- Modal -->
<div id="modal" class="modal" aria-hidden="true">
  <div class="modal-content">
    <div class="modal-left">
      <img id="modal-image" src="" alt="Monastery image">
      <div id="modal-thumbs" class="thumbbar"></div>
    </div>
    <div class="modal-right">
      <h2 id="modal-title" style="margin:0"></h2>
      <div id="modal-meta" class="meta" style="margin-top:6px"></div>
      <p id="modal-notes" class="meta" style="margin-top:10px"></p>
      <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap">
        <a id="modal-360" class="btn btn-soft" href="#">Open 360°</a>
        <a id="modal-directions" class="btn btn-soft" target="_blank">Google Maps</a>
      </div>
    </div>
    <button id="modal-close" class="btn btn-primary" style="position:absolute;right:18px;top:18px">✖</button>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', async () => {
  try {
    const res = await fetch('data/monasteries.json');
    const D = await res.json();

    const exploreList = document.getElementById('explore-list');
    const districtSelect = document.getElementById('district');
    const traditionSelect = document.getElementById('tradition');
    const searchInput = document.getElementById('q');

    // Populate filters
    [...new Set(D.map(d => d.district))].sort().forEach(d =>
      districtSelect.appendChild(new Option(d, d))
    );
    [...new Set(D.map(d => d.tradition))].sort().forEach(t =>
      traditionSelect.appendChild(new Option(t, t))
    );

    function renderList(items) {
      exploreList.innerHTML = '';
      if(!items.length) {
        exploreList.innerHTML = '<p style="grid-column:1/-1;text-align:center;color:var(--muted)">No monasteries found.</p>';
        return;
      }
      items.forEach(it => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <img src="${it.images?.[0] || 'https://via.placeholder.com/320x200'}" alt="${it.name}">
          <h3>${it.name}</h3>
          <p>${it.district} • ${it.tradition}</p>
        `;
        card.addEventListener('click', () => openModal(it));
        exploreList.appendChild(card);
      });
    }

    function openModal(it) {
      const modal = document.getElementById('modal');
      modal.setAttribute('aria-hidden','false');
      document.getElementById('modal-image').src = it.images?.[0] || '';
      document.getElementById('modal-title').textContent = it.name;
      document.getElementById('modal-meta').textContent = `${it.district} • ${it.tradition}`;
      document.getElementById('modal-notes').textContent = it.notes || '';
      document.getElementById('modal-360').href = `view360.html?id=${it.id}`;
      if(it.lat && it.lng) {
        document.getElementById('modal-directions').href = `https://www.google.com/maps?q=${it.lat},${it.lng}`;
        document.getElementById('modal-directions').style.display='inline-block';
      } else {
        document.getElementById('modal-directions').style.display='none';
      }

      // Thumbnails
      const thumbs = document.getElementById('modal-thumbs');
      thumbs.innerHTML = '';
      (it.images || []).forEach(src => {
        const img = document.createElement('img');
        img.src = src;
        img.addEventListener('click', ()=> {
          document.getElementById('modal-image').src = src;
        });
        thumbs.appendChild(img);
      });
    }

    function filter() {
      const q = searchInput.value.toLowerCase();
      const district = districtSelect.value;
      const tradition = traditionSelect.value;
      renderList(D.filter(it => {
        const matchesQ = it.name.toLowerCase().includes(q) || (it.notes?.toLowerCase().includes(q));
        const matchesDistrict = district ? it.district === district : true;
        const matchesTradition = tradition ? it.tradition === tradition : true;
        return matchesQ && matchesDistrict && matchesTradition;
      }));
    }

    searchInput.addEventListener('input', filter);
    districtSelect.addEventListener('change', filter);
    traditionSelect.addEventListener('change', filter);

    document.getElementById('modal-close').addEventListener('click', () => {
      document.getElementById('modal').setAttribute('aria-hidden','true');
    });

    renderList(D);
  } catch(err) {
    console.error('Failed to load monastery data:', err);
  }
});
</script>

</body>
</html>
